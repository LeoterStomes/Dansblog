---
/*
 * Responsive tag badge renderer shared by list cards.
 * Encodes small-screen truncation rules so each page does not duplicate logic.
 */
interface Props {
	// Raw tag list from frontmatter.
	tags?: string[];
	// Mobile cap includes the "+N" badge slot.
	maxMobile?: number;
	// `null` means show all tags on desktop.
	maxDesktop?: number | null;
	// Base path prefix for tags routes.
	base?: string;
}

const {
	tags = [],
	maxMobile = 3,
	maxDesktop = null,
	base = import.meta.env.BASE_URL,
} = Astro.props as Props;

const cleanTags = tags.filter((tag) => typeof tag === 'string' && tag.trim().length > 0);
// Reserve one badge slot for +N when mobile tag count exceeds the cap.
const mobileVisibleCount = cleanTags.length > maxMobile ? Math.max(maxMobile - 1, 0) : maxMobile;
const mobileTags = cleanTags.slice(0, mobileVisibleCount);
const mobileRemaining = cleanTags.length > maxMobile ? Math.max(cleanTags.length - mobileVisibleCount, 0) : 0;
const desktopTags = maxDesktop == null ? cleanTags : cleanTags.slice(0, maxDesktop);
const desktopRemaining = maxDesktop == null ? 0 : Math.max(cleanTags.length - desktopTags.length, 0);
---

{
	cleanTags.length > 0 && (
		<>
			<div class="flex flex-wrap gap-2 md:hidden">
				{
					mobileTags.map((tag) => (
						<a
							href={`${base}tags/${encodeURIComponent(tag)}/`}
							class="inline-flex max-w-[7rem] items-center truncate rounded-md bg-zinc-100 px-2 py-1 text-xs text-zinc-600 no-underline transition hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-300 dark:hover:bg-zinc-800"
						>
							{tag}
						</a>
					))
				}
				{
					mobileRemaining > 0 && (
						<span class="inline-flex items-center rounded-md bg-zinc-100 px-2 py-1 text-xs text-zinc-600 dark:bg-zinc-900 dark:text-zinc-300">
							+{mobileRemaining}
						</span>
					)
				}
			</div>
			<div class="hidden gap-2 md:flex md:flex-wrap md:justify-end">
				{
					desktopTags.map((tag) => (
						<a
							href={`${base}tags/${encodeURIComponent(tag)}/`}
							class="inline-flex max-w-[7rem] items-center truncate rounded-md bg-zinc-100 px-2 py-1 text-xs text-zinc-600 no-underline transition hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-300 dark:hover:bg-zinc-800"
						>
							{tag}
						</a>
					))
				}
				{
					desktopRemaining > 0 && (
						<span class="inline-flex items-center rounded-md bg-zinc-100 px-2 py-1 text-xs text-zinc-600 dark:bg-zinc-900 dark:text-zinc-300">
							+{desktopRemaining}
						</span>
					)
				}
			</div>
		</>
	)
}
